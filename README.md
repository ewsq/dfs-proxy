## 系统简介
   该系统基于开源的SeaweedFS文件系统，利用了其基本的分布式存储和备份功能。代理模块直接采用Spring Boot来搭建，数据层基于MySQL数据库，Druid作为数据库连接池，同时也带有可选的redis缓存，以加快数据的存取速度和减轻数据库负载。文件系统的管理模块使用MVC的设计思想，前端基于Thymeleaf模板技术，结合Bootstrap框架、jQuery库、AJAX技术实现数据的展示和近实时更新。
## 总体架构
![分布式文件系统架构图](img/分布式文件系统架构.png)
如上图所示，在底层分布式文件系统之上搭建代理层，即该系统，所有的功能包括文件目录，文件上传下载的授权等都由该管理系统完成，文件流也经由此系统授权之后才流入或从磁盘读取出返回给客户端，这种方式虽然牺牲了部分性能，
但极大提高了系统的可维护性，也解决了原底层文件系统的单点故障问题。应用的文件微服务是FileService，前端在上传或下载私有文件前可以根据业务定义的权限从FileService请求授权签名，然后利用该签名直接从管理系统上传或下载私有文件，
与之相对比的OSS存储系统，两者所处的位置是一致的，从而也能够保证与OSS在顶层架构上的兼容。该架构图还展示出底层SeaweedFS的存储架构，它包含两个互为备份的数据中心，可以进行分布式集群部署，上层dfs-manager也可以多机部署，它将数据存储在数据库中，
同时也有部分数据缓存在Redis中以加快访问速度，减轻数据库服务器的压力。

![部署架构图](img/SeaweedFS部署架构.png)
结合SeaweedFS本身的分布式特性，同时考虑到系统的非功能性需求包括可用性，数据的安全性、性能、伸缩性等，将SeaweedFS的Master和Volume节点，管理系统以及它所依赖的Redis集群和数据库服务器集群按照如上图所示的方式进行部署。  
整个分布式文件系统所处的位置如图所示，它处在应用的下层，包含四个可稳定运行的集群，分别是底层文件存储集群，管理系统集群，Redis缓存集群和数据库服务器集群。底层文件存储集群部署方式较为复杂，为了确保数据的安全和不易丢失，将整个文件存储集群分为2个数据中心，
这两个中心互为数据备份，同时这种方式也能很好地均衡服务器及磁盘的读请求访问负载，因为同一份文件在两个数据中心都有存储，访问请求随机地路由到两个中心的任一一个，这取决于SeaweedFS的负载均衡配置。  
由于目前企业的实际机器状况，在3台服务器中均部署运行master节点，由于3台机器的性能有差别，Server2的机器性能较好，因此在Server2上运行较多的volume节点，分别属于不同的数据中心，其中一个volume节点按照规范应该是对应一个独立的磁盘，但是由于磁盘数量限制，
目前不同volume可能会复用同一块磁盘，可以通过购买廉价机械硬盘解决这个问题。其余2台机器的volume则相互隔离属于不同的数据中心，采用这种方式最大的优点和目的就是在机器数量限制的情况下避免单点故障导致一个数据中心的崩溃，比如，当这3台服务器中的任意一台宕机时，
其余2台均能够完成文件的写入和读取操作因为这2台均不在一个数据中心，这样极大地提高了系统的可用性，同时也对性能有一定优化作用。  
上游文件管理系统也采用集群化多实例的部署方式，由于该系统本身的无状态性，采用这种方式就不需要考虑分布式数据的一致性等问题。上层也只需配置类似于nignx的代理模块以实现负载均衡的功能。这样也会减轻高负载情况下的单机压力，同时减小单机故障导致整个服务不可用的概率。

